<!--
  ~ Copyright (c) 2014 Hewlett-Packard Development Company, L.P.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License"); you may
  ~ not use this file except in compliance with the License. You may obtain
  ~ a copy of the License at
  ~
  ~         http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  ~ WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing permissions and limitations
  ~ under the License.
  -->
<div class="row">
    <div class="col-sm-6 col-xs-12">
        <a href=""
           ng-click="showAddTaskForm = !showAddTaskForm"
           ng-show="isLoggedIn"
           class="pull-right btn btn-default btn-sm">
            <span>
                <i class="fa fa-plus"
                   ng-hide="showAddTaskForm"></i>
                <i class="fa fa-minus"
                   ng-show="showAddTaskForm"></i>
            </span>
        </a>
        <h4>Tasks</h4>

        <div class="well" ng-show="showAddTaskForm">
            <form role="form" name="taskForm">
                <div class="form-group row">
                    <label for="title" class="col-sm-2 control-label">
                        Task Title:
                    </label>

                    <div class="col-sm-10">
                        <input id="title"
                               type="text"
                               class="form-control"
                               ng-model="newTask.title"
                               required
                               placeholder="Task Title">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="project" class="col-sm-2 control-label">
                        Task Project:
                    </label>

                    <div class="col-sm-10">
                        <select ng-model="newTask.project_id"
                                id="project"
                                name="project"
                                class="form-control"
                                required
                                ng-options="p.id as p.name for p in projects"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-default"
                                ng-click="addTask()"
                                ng-disabled="!taskForm.$valid">
                            Add task
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <table class="table table-striped">
            <tbody>
            <tr ng-repeat="task in tasks"
                ng-controller="StoryTaskListItemController">
                <td>
                    <span class="label label-default pull-right">
                        {{task.status}}
                    </span>

                    <p><strong>
                        <a href="">{{task.title}}</a>
                    </strong></p>
                    <a href="#!/project/{{project.id}}/overview"
                       ng-show="project">
                        {{project.name}}
                    </a>

                        <span class="text-danger" ng-hide="project">
                            Project not found
                        </span>
                    <small class="text-muted">{{task.description}}</small>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="col-sm-6 col-xs-12">
        <h4>Discussion</h4>

        <div class="discussion">
            <div class="alert alert-warning"
                 ng-show="comments.length == 0">
                The discussion hasn't started yet
            </div>
            <div ng-repeat="comment in comments"
                 ng-controller="StoryDetailCommentController"
                 class="discussion-comment">
                <p class="discussion-comment-author">
                    {{author.full_name}}
                </p>

                <p ng-show="comment.content">{{comment.content}}</p>
                <p><em ng-hide="comment.content"
                    class="text-muted">
                    The author left a blank comment.
                </em></p>
            </div>

            <form class="discussion-comment-form comment"
                  id="commentForm"
                  name="commentForm"
                  ng-show="isLoggedIn">
                <div class="form-group">
                    <textarea id="comment"
                              placeholder="Enter your comment here"
                              class="form-control"
                              rows="3"
                              required
                              ng-disabled="isSavingComment"
                              ng-shift-enter="addComment()"
                              ng-model="newComment.content">
                    </textarea>
                </div>
                <div class="form-group">
                    <button type="button"
                            class="btn btn-primary pull-right"
                            ng-click="addComment()"
                            ng-disabled="!commentForm.$valid || isSavingComment">
                        Comment
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
